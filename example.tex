\documentclass{article}

\usepackage{verbatim}
\input{mcorelisting}

\begin{document}
Line~\ref{l:magic} is where the magic happens. This is inline code
\mcoreinline{let f = lam x. x}.

\def \mcorefontsize {\tiny}
%
Setting \verb|\mcorefontsize| to \verb|\tiny| gives tiny code: \mcoreinline{let
  f = lam x. x}.
%
\def \mcorefontsize {\normalsize}

\begin{figure}[h]
  \begin{mcore-lines}
  include "seq.mc"

  let foo =
    -- This is a comment
    let s = "magic" in (*@\label{l:magic}@*)
    let one = 1 in
    lam x. x

  let bar: Int -> (Int -> Int) =
    lam i.
    addi i

  mexpr
    utest 1 with 1 in ()
  \end{mcore-lines}
  \caption{With line numbers.}
\end{figure}

\begin{figure}[h]
  \begin{mcore}
  include "seq.mc"

  let foo =
    -- This is a comment
    let s = "magic" in
    let one = 1 in
    lam x. x

  let bar: Int -> (Int -> Int) =
    lam i.
    addi i

  mexpr
    utest 1 with 1 in ()
  \end{mcore}
  \caption{Without line numbers.}
\end{figure}

\lstinputlisting[language=MCore,caption={Included from file.}]{example.mc}

\end{document}